#!/bin/bash
# 完全重启所有K线服务

# 根据实际路径调整
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
cd "$SCRIPT_DIR"

echo "=========================================="
echo "停止所有K线服务..."
echo "=========================================="
./stop.sh

echo ""
echo "等待5秒确保所有进程完全停止..."
sleep 5

echo ""
echo "=========================================="
echo "启动所有K线服务..."
echo "=========================================="
./start.sh

echo ""
echo "等待5秒让所有服务完全启动..."
sleep 5

echo ""
echo "=========================================="
echo "检查服务状态..."
echo "=========================================="
ps aux | grep -E "(swap_kline|swap_market|swap_depth|swap_trade|swap_forex)" | grep -v grep

echo ""
echo "=========================================="
echo "查看最近的日志..."
echo "=========================================="
tail -30 /tmp/workerman.log

echo ""
echo "=========================================="
echo "实时监控日志（按 Ctrl+C 停止）:"
echo "=========================================="
tail -f /tmp/workerman.log | grep -E "(定时器|自动拉取|推送成功|异常)"
